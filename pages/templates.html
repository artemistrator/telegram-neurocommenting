<div class="max-w-7xl" data-testid="page-templates">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">–®–∞–±–ª–æ–Ω—ã –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        <div class="flex gap-2">
            <button id="refresh-templates-btn"
                class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg font-medium transition flex items-center">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </button>
            <button id="create-template-btn"
                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition">
                ‚ûï –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
            </button>
        </div>
    </div>

    <!-- Templates List -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="templates-container"
        data-testid="templates-list">
        <!-- Templates will be loaded here -->
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="fixed top-4 right-4 bg-white shadow-lg rounded-lg p-4 hidden transition-all z-50 max-w-sm">
    <div class="flex items-center">
        <span id="toast-icon" class="text-2xl mr-3"></span>
        <p id="toast-message" class="text-sm font-medium text-gray-800"></p>
    </div>
</div>

<!-- Template Modal -->
<div id="templateModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center p-6 border-b">
            <h2 class="text-2xl font-bold text-gray-800" id="modal-title">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</h2>
            <button id="close-modal-btn" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <form id="template-form" class="p-6 space-y-6">
            <input type="hidden" id="template-id">

            <!-- Template Name -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ <span
                        class="text-red-500">*</span></label>
                <input type="text" id="template-name" required
                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>

            <!-- Tabs -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="profile-tab" type="button" role="tab" aria-selected="true"
                        class="border-blue-500 text-blue-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        üë§ –ü—Ä–æ—Ñ–∏–ª—å
                    </button>
                    <button id="comment-tab" type="button" role="tab" aria-selected="false"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        üí¨ –ö–æ–º–º–µ–Ω—Ç—ã
                    </button>
                </nav>
            </div>

            <!-- Profile Tab Panel -->
            <div id="profile-panel" role="tabpanel" class="space-y-6">
                <!-- Personal Info Section -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-medium text-gray-800 mb-3">üë§ –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–ò–º—è</label>
                                <input type="text" id="template-first-name"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" id="template-last-name"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ë–∏–æ</label>
                            <textarea id="template-bio" rows="3"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ê–≤–∞—Ç–∞—Ä (URL –∏–ª–∏ ID
                                —Ñ–∞–π–ª–∞)</label>
                            <input type="text" id="template-avatar"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Channel Settings Section -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-medium text-gray-800 mb-3">üì¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</label>
                            <input type="text" id="template-channel-title"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</label>
                            <textarea id="template-channel-description" rows="2"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–®–∞–±–ª–æ–Ω —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ—Å—Ç–∞</label>
                            <textarea id="template-post-text-template" rows="3"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                                placeholder="–®–∞–±–ª–æ–Ω —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comment Policy Tab Panel -->
            <div id="comment-panel" role="tabpanel" class="space-y-6 hidden">
                <!-- AI Settings Section -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-medium text-gray-800 mb-3">ü§ñ AI –ü–µ—Ä—Å–æ–Ω–∞ (–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            System Prompt
                            <span class="text-xs text-gray-500 font-normal ml-1">(–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                                –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ
                                –ø—Ä–æ–º–ø—Ç–∞)</span>
                        </label>
                        <textarea id="template-commenting-prompt" rows="4"
                            class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∫—Ä–∏–ø—Ç–æ-—ç–Ω—Ç—É–∑–∏–∞—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π..."></textarea>
                    </div>
                </div>

                <!-- Commenting Behavior Section -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-medium text-gray-800 mb-3">üõ† –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è</label>
                                <input type="text" id="template-style" placeholder="–ù–∞–ø—Ä: –î–µ—Ä–∑–∫–∏–π, –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</label>
                                <input type="text" id="template-tone" placeholder="–ù–∞–ø—Ä: –ü–æ–∑–∏—Ç–∏–≤–Ω–∞—è, –°–∫–µ–ø—Ç–∏—á–Ω–∞—è"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–ú–∞–∫—Å. —Å–ª–æ–≤</label>
                                <input type="number" id="template-max-words" placeholder="50" min="1" max="1000"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–ú–∏–Ω. –¥–ª–∏–Ω–∞ –ø–æ—Å—Ç–∞</label>
                                <input type="number" id="template-min-post-length" placeholder="0" min="0" max="10000"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–†–µ–∂–∏–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</label>
                            <select id="template-filter-mode"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="none">–ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–∫–æ–º–º–µ–Ω—Ç–∏—Ç—å –≤—Å—ë)</option>
                                <option value="keywords">–ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (Keywords)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
                                <span class="text-xs text-gray-500 font-normal ml-1">(–ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</span>
                            </label>
                            <textarea id="template-filter-keywords" rows="2" placeholder="–∫—Ä–∏–ø—Ç–∞, –±–∏—Ç–∫–æ–∏–Ω, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-3 pt-4">
                <button type="button" id="cancel-template-btn"
                    class="bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded-lg font-medium transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button type="button" id="submit-template-btn"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </form>
    </div>
</div>

<script type="module">
    // Import and initialize modules
    import { initTemplatesPage, loadTemplates, cleanupTemplatesPage } from '/static/js/pages/templates.page.js';
    import { initTemplateModal } from '/static/js/pages/template.modal.js';

    // Make loadTemplates globally available for refresh button
    window.loadTemplates = loadTemplates;

    // Boot function to initialize the page
    function boot() {
        console.log('Templates page loaded, initializing...');
        initTemplatesPage();
        initTemplateModal();
    }

    // Initialize page immediately if DOM is already loaded, otherwise wait for DOMContentLoaded
    if (document.readyState !== 'loading') {
        boot();
    } else {
        document.addEventListener('DOMContentLoaded', boot);
    }

    // Cleanup when navigating away (if needed)
    window.addEventListener('beforeunload', function () {
        cleanupTemplatesPage();
    });
</script>